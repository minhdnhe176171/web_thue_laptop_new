@model IEnumerable<web_chothue_laptop.Models.Laptop>
@{
    ViewData["Title"] = "Thông Báo Lịch Hẹn Nhận Máy";
}

<style>
    .container, .body-content {
        padding: 0 !important;
        margin: 0 !important;
        max-width: 100% !important;
    }

    .notifications-wrapper {
        min-height: calc(100vh - 60px);
        background-color: #f8f9fa;
        margin-top: -1.5rem;
        padding: 2rem;
    }

    .notification-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
    }

    .notification-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .notification-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 12px 12px 0 0;
    }

    .notification-body {
        padding: 1.5rem;
    }

    .info-box {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .info-box h6 {
        color: #495057;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .info-box p {
        margin-bottom: 0;
        color: #6c757d;
    }

    .badge-status {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
    }
</style>

<div class="notifications-wrapper">
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary fw-bold">
        <i class="fas fa-bell me-2"></i>Thông Báo Lịch Hẹn Nhận Máy
    </h2>
    <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Quay lại
    </a>
</div>

<!-- Form tìm kiếm -->
<div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-10">
                <label class="form-label fw-semibold">Tìm kiếm theo tên laptop, khách hàng hoặc email</label>
                <input type="search" 
                       name="search" 
                       value="@(ViewBag.Search ?? "")" 
                       class="form-control" 
                       placeholder="Nhập tên laptop, tên khách hàng hoặc email..." />
            </div>
            <div class="col-md-2 d-flex align-items-end gap-2">
                <button class="btn btn-primary w-100" type="submit">
                    <i class="fas fa-search"></i> Tìm
                </button>
                @if (!string.IsNullOrEmpty(ViewBag.Search))
                {
                    <a href="@Url.Action("Notifications", "Student")" class="btn btn-secondary">
                        <i class="fas fa-redo"></i>
                    </a>
                }
            </div>
        </form>
    </div>
</div>

@if (!Model.Any())
{
    <div class="alert alert-info shadow-sm">
        <div class="d-flex align-items-center">
            <i class="fas fa-info-circle fa-2x me-3"></i>
            <div>
                @if (!string.IsNullOrEmpty(ViewBag.Search))
                {
                    <h5 class="alert-heading mb-1">Không tìm thấy kết quả</h5>
                    <p class="mb-0">Không có thông báo nào phù hợp với từ khóa "<strong>@ViewBag.Search</strong>". Vui lòng thử lại với từ khóa khác.</p>
                }
                else
                {
                    <h5 class="alert-heading mb-1">Chưa có thông báo nào</h5>
                    <p class="mb-0">Bạn chưa có laptop nào đã được duyệt. Khi có đơn hàng được duyệt, Staff sẽ tạo lịch hẹn cho bạn đến nhận máy tại tòa Delta.</p>
                }
            </div>
        </div>
    </div>
}
else
{
    @foreach (var laptop in Model)
    {
        // CHỈ lấy booking APPROVED (chờ Staff tạo lịch hẹn)
        var approvedBooking = laptop.Bookings?
            .Where(b => b.Status?.StatusName?.ToLower() == "approved")
            .OrderByDescending(b => b.StartTime)
            .FirstOrDefault();

        if (approvedBooking != null)
        {
            <div class="notification-card">
                <div class="notification-header">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h4 class="mb-2">
                                <i class="fas fa-laptop me-2"></i>@laptop.Name
                            </h4>
                            <p class="mb-0 opacity-90">
                                <i class="fas fa-building me-2"></i>@laptop.Brand?.BrandName
                            </p>
                        </div>
                        <span class="badge badge-status bg-warning text-dark">
                            Chờ Lịch Hẹn
                        </span>
                    </div>
                </div>

                <div class="notification-body">
                 

                    <!-- Bảng thông tin lịch hẹn -->
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th><i class="fas fa-laptop me-2"></i>Laptop</th>
                                    <th><i class="fas fa-user-tie me-2"></i>Staff ID</th>
                                    <th><i class="fas fa-clock me-2"></i>Thời Gian Hẹn Nhận Máy</th>
                                    <th><i class="fas fa-map-marker-alt me-2"></i>Địa Điểm Nhận Máy</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="fw-bold">@laptop.Name</td>
                                    <td class="text-muted">
                                        <em>Chờ Staff tạo đơn</em>
                                    </td>
                                    <td class="text-muted">
                                        <em>--:-- --/--/----</em>
                                    </td>
                                    <td>
                                        <strong class="text-primary">Tòa Delta</strong><br />
                                        <small class="text-muted">Thư viện trường - FPT University</small>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <hr class="my-3" />

                    <!-- Thông tin khách hàng và đơn hàng -->
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="info-box">
                                <h6>
                                    <i class="fas fa-user text-primary me-2"></i>Khách Hàng
                                </h6>
                                <p class="fw-bold">
                                    @(approvedBooking.Customer?.LastName) @(approvedBooking.Customer?.FirstName)
                                </p>
                                <small class="text-muted">
                                    <i class="fas fa-envelope me-1"></i>@approvedBooking.Customer?.Email
                                </small>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="info-box">
                                <h6>
                                    <i class="fas fa-calendar text-success me-2"></i>Thời Gian Thuê
                                </h6>
                                <p>
                                    <strong>Từ:</strong> @approvedBooking.StartTime.ToString("dd/MM/yyyy")<br />
                                    <strong>Đến:</strong> @approvedBooking.EndTime.ToString("dd/MM/yyyy")
                                </p>
                            </div>
                        </div>

                   
                    </div>

                    <hr class="my-3" />

                    <div class="alert alert-info mb-0">
                        <h6 class="alert-heading">
                            <i class="fas fa-info-circle me-2"></i>Hướng Dẫn
                        </h6>
                        <ul class="mb-0">
                            <li>Staff sẽ tạo lịch hẹn và thông báo thời gian cụ thể cho bạn</li>
                            <li>Địa điểm nhận máy: <strong>Tòa Delta - Thư viện trường</strong></li>
                            <li>Vui lòng theo dõi thông báo để biết thời gian chính xác</li>
                            <li>Khi đến hẹn, vui lòng mang theo CMND/CCCD để xác nhận</li>
                        </ul>
                    </div>
                </div>
            </div>
        }
    }
}
</div>
