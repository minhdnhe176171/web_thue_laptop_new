@model web_chothue_laptop.Models.Laptop
@{
    ViewData["Title"] = "Chi tiết laptop";
}

@functions {
    private static string TranslateStatus(string? name) => name?.ToLower() switch
    {
        "pending" => "Đang chờ xử lý",
        "approved" => "Đã phê duyệt",
        "rejected" => "Bị từ chối",
        _ => name ?? string.Empty
    };
}

<h2>Chi tiết laptop</h2>

<div class="card">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0">@Model.Name</h4>
    </div>
    <div class="card-body">
        <div class="row">
            <!-- Cột ảnh -->
            <div class="col-md-4 mb-3">
                <h5 class="border-bottom pb-2">
                    <i class="fas fa-image me-2"></i>Hình ảnh
                </h5>
                @if (!string.IsNullOrEmpty(Model.ImageUrl))
                {
                    <div class="text-center">
                        <img src="@Model.ImageUrl" alt="@Model.Name" 
                             class="img-fluid rounded shadow-sm" 
                             style="max-height: 400px; width: 100%; object-fit: cover;" />
                    </div>
                }
                else
                {
                    <div class="text-center p-5 bg-light rounded">
                        <i class="fas fa-laptop fa-5x text-muted mb-3"></i>
                        <p class="text-muted mb-0">Chưa có hình ảnh</p>
                    </div>
                }
            </div>

            <!-- Cột thông tin -->
            <div class="col-md-8">
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="border-bottom pb-2">
                            <i class="fas fa-info-circle me-2"></i>Thông tin chung
                        </h5>
                        <dl class="row">
                            <dt class="col-sm-4">Tên laptop:</dt>
                            <dd class="col-sm-8">@Model.Name</dd>

                            <dt class="col-sm-4">Hãng:</dt>
                            <dd class="col-sm-8">@Model.Brand?.BrandName</dd>

                            <dt class="col-sm-4">Giá thuê/ngày:</dt>
                            <dd class="col-sm-8">
                                <span class="text-success fw-bold fs-5">
                                    @(Model.Price?.ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN")) ?? "-")
                                </span>
                            </dd>

                            <dt class="col-sm-4">Trạng thái:</dt>
                            <dd class="col-sm-8">
                                <span class="badge @(Model.Status?.StatusName?.ToLower() switch 
                                    {
                                        "pending" => "bg-warning text-dark",
                                        "approved" => "bg-success",
                                        "rejected" => "bg-danger",
                                        "available" => "bg-info",
                                        _ => "bg-secondary"
                                    })">
                                    @TranslateStatus(Model.Status?.StatusName)
                                </span>
                            </dd>

                            <dt class="col-sm-4">Ngày tạo:</dt>
                            <dd class="col-sm-8">
                                <i class="fas fa-calendar-plus text-muted me-1"></i>
                                @(Model.CreatedDate?.ToString("dd/MM/yyyy HH:mm") ?? "-")
                            </dd>

                            <dt class="col-sm-4">Đến hạn:</dt>
                            <dd class="col-sm-8">
                                @if (Model.EndTime.HasValue)
                                {
                                    <span class="@(Model.EndTime.Value < DateTime.Today ? "text-danger fw-bold" : "text-success")">
                                        <i class="fas fa-calendar-times me-1"></i>
                                        @Model.EndTime.Value.ToString("dd/MM/yyyy")
                                        @if (Model.EndTime.Value < DateTime.Today)
                                        {
                                            <i class="bi bi-exclamation-triangle-fill ms-1"></i>
                                            <small class="d-block text-danger">(Đã quá hạn)</small>
                                        }
                                        else
                                        {
                                            var daysLeft = (Model.EndTime.Value - DateTime.Today).Days;
                                            <small class="d-block text-muted">(Còn @daysLeft ngày)</small>
                                        }
                                    </span>
                                }
                                else
                                {
                                    <span>-</span>
                                }
                            </dd>
                        </dl>
                    </div>

                    <div class="col-md-6">
                        <h5 class="border-bottom pb-2">
                            <i class="fas fa-cogs me-2"></i>Thông số kỹ thuật
                        </h5>
                        @{
                            var detail = Model.LaptopDetails.FirstOrDefault();
                        }
                        @if (detail != null)
                        {
                            <dl class="row">
                                @if (!string.IsNullOrEmpty(detail.Cpu))
                                {
                                    <dt class="col-sm-4">
                                        <i class="fas fa-microchip text-primary"></i> CPU:
                                    </dt>
                                    <dd class="col-sm-8">@detail.Cpu</dd>
                                }

                                @if (!string.IsNullOrEmpty(detail.RamSize))
                                {
                                    <dt class="col-sm-4">
                                        <i class="fas fa-memory text-success"></i> RAM:
                                    </dt>
                                    <dd class="col-sm-8">@detail.RamSize</dd>
                                }

                                @if (!string.IsNullOrEmpty(detail.Storage))
                                {
                                    <dt class="col-sm-4">
                                        <i class="fas fa-hdd text-info"></i> Lưu trữ:
                                    </dt>
                                    <dd class="col-sm-8">@detail.Storage</dd>
                                }

                                @if (!string.IsNullOrEmpty(detail.Gpu))
                                {
                                    <dt class="col-sm-4">
                                        <i class="fas fa-th text-warning"></i> GPU:
                                    </dt>
                                    <dd class="col-sm-8">@detail.Gpu</dd>
                                }

                                @if (!string.IsNullOrEmpty(detail.ScreenSize))
                                {
                                    <dt class="col-sm-4">
                                        <i class="fas fa-desktop text-secondary"></i> Màn hình:
                                    </dt>
                                    <dd class="col-sm-8">@detail.ScreenSize</dd>
                                }

                                @if (!string.IsNullOrEmpty(detail.Os))
                                {
                                    <dt class="col-sm-4">
                                        <i class="fas fa-windows text-primary"></i> OS:
                                    </dt>
                                    <dd class="col-sm-8">@detail.Os</dd>
                                }
                            </dl>
                        }
                        else
                        {
                            <div class="alert alert-info mb-0">
                                <i class="fas fa-info-circle me-2"></i>
                                Chưa có thông tin chi tiết
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-footer">

        <a class="btn btn-secondary" asp-action="Index">
            <i class="bi bi-arrow-left"></i> Quay lại
        </a>
        
        @* Chỉ hiển thị nút Xóa khi trạng thái là Pending *@
        @if (Model.Status?.StatusName?.ToLower() == "pending")
        {
            <form asp-action="Delete" asp-route-id="@Model.Id" method="post" style="display:inline" onsubmit="return confirm('Bạn có chắc muốn xóa laptop này không?');">
                @Html.AntiForgeryToken()
                <button class="btn btn-danger" type="submit">
                    <i class="bi bi-trash"></i> Xóa
                </button>
            </form>
        }
    </div>
</div>