@model IEnumerable<web_chothue_laptop.Models.Booking>

@{
    ViewData["Title"] = "Lịch Sử Thuê";
    Layout = "_ManagerLayout";
    var customer = ViewBag.Customer as web_chothue_laptop.Models.Customer;
}

<style>
    .customer-info-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .blacklist-badge {
        background-color: #dc3545;
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: bold;
    }

    .normal-badge {
        background-color: #28a745;
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: bold;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-primary">
        <i class="fas fa-history"></i> Lịch Sử Thuê
    </h3>
    <a asp-action="CustomerManagement" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Quay Lại
    </a>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        <i class="fas fa-check-circle me-2"></i>@TempData["SuccessMessage"]
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">
        <i class="fas fa-exclamation-circle me-2"></i>@TempData["ErrorMessage"]
    </div>
}

@if (customer != null)
{
    <div class="customer-info-card">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h4 class="mb-2">
                    <i class="fas fa-user"></i>
                    @customer.LastName @customer.FirstName
                </h4>
                <p class="mb-1"><i class="fas fa-envelope"></i> @customer.Email</p>
                <p class="mb-1"><i class="fas fa-phone"></i> @(customer.Phone ?? "N/A")</p>
                <p class="mb-0"><i class="fas fa-id-card"></i> @(customer.IdNo ?? "N/A")</p>
            </div>
            <div class="col-md-4 text-end">
                @if (customer.BlackList == true)
                {
                    <span class="blacklist-badge">
                        <i class="fas fa-ban"></i> BLACKLIST
                    </span>
                }
                else
                {
                    <span class="normal-badge">
                        <i class="fas fa-check-circle"></i> Bình Thường
                    </span>
                }

                <div class="mt-3">
                    <form asp-action="ToggleBlacklist"
                          asp-route-id="@customer.Id"
                          method="post"
                          class="d-inline">
                        @Html.AntiForgeryToken()

                        @if (customer.BlackList == true)
                        {
                            <button type="submit"
                                    class="btn btn-success btn-sm"
                                    onclick="return confirm('Xóa customer khỏi blacklist?');">
                                <i class="fas fa-check"></i> Xóa Blacklist
                            </button>
                        }
                        else
                        {
                            <button type="submit"
                                    class="btn btn-danger btn-sm"
                                    onclick="return confirm('Thêm customer vào blacklist?');">
                                <i class="fas fa-ban"></i> Thêm Blacklist
                            </button>
                        }
                    </form>
                </div>
            </div>
        </div>
    </div>
}

<div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
            <i class="fas fa-list"></i>
            Danh Sách Đơn Thuê (@(Model?.Count() ?? 0))
        </h5>
    </div>

    <div class="card-body p-0">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th class="ps-4">Mã Đơn</th>
                    <th>Laptop</th>
                    <th>Ngày Bắt Đầu</th>
                    <th>Ngày Kết Thúc</th>
                    <th>Tổng Tiền</th>
                    <th>Trạng Thái</th>
                    <th>Nhân Viên</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var booking in Model)
                    {
                        <tr>
                            <td class="ps-4 fw-bold text-primary">#@booking.Id</td>
                            <td>@booking.Laptop?.Name</td>
                            <td>@booking.StartTime.ToString("dd/MM/yyyy")</td>
                            <td>@booking.EndTime.ToString("dd/MM/yyyy")</td>
                            <td>@booking.TotalPrice?.ToString("N0") đ</td>
                            <td>
                                <span class="badge bg-info">
                                    @booking.Status?.StatusName
                                </span>
                            </td>
                            <td>
                                @(booking.Staff != null
                                    ? $"{booking.Staff.LastName} {booking.Staff.FirstName}"
                                    : "N/A")
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="7" class="text-center py-5 text-muted">
                            Không có lịch sử thuê
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
